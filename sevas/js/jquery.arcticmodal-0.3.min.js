"use strict";function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){var o={type:"html",content:"",url:"",ajax:{},ajax_request:null,closeOnEsc:!0,closeOnOverlayClick:!0,clone:!1,overlay:{block:void 0,tpl:'<div class="arcticmodal-overlay"></div>',css:{backgroundColor:"#000",opacity:.6}},container:{block:void 0,tpl:'<div class="arcticmodal-container"><table class="arcticmodal-container_i"><tr><td class="arcticmodal-container_i2"></td></tr></table></div>'},wrap:void 0,body:void 0,errors:{tpl:'<div class="arcticmodal-error arcticmodal-close"></div>',autoclose_delay:2e3,ajax_unsuccessful_load:"Error"},openEffect:{type:"fade",speed:400},closeEffect:{type:"fade",speed:400},beforeOpen:e.noop,afterOpen:e.noop,beforeClose:e.noop,afterClose:e.noop,afterLoading:e.noop,afterLoadingOnShow:e.noop,errorLoading:e.noop},t=0,a=e([]),r={isEventOut:function(o,t){var a=!0;return e(o).each(function(){e(t.target).get(0)==e(this).get(0)&&(a=!1),0==e(t.target).closest("HTML",e(this).get(0)).length&&(a=!1)}),a}},c={getParentEl:function(o){var t=e(o);return t.data("arcticmodal")?t:!!(t=e(o).closest(".arcticmodal-container").data("arcticmodalParentEl"))&&t},transition:function(o,t,a,r){switch(r=void 0==r?e.noop:r,a.type){case"fade":"show"==t?o.fadeIn(a.speed,r):o.fadeOut(a.speed,r);break;case"none":"show"==t?o.show():o.hide(),r()}},prepare_body:function(o,t){e(".arcticmodal-close",o.body).unbind("click.arcticmodal").bind("click.arcticmodal",function(){return t.arcticmodal("close"),!1})},init_el:function(o,i){var l=o.data("arcticmodal");if(!l){if(l=i,t++,l.modalID=t,l.overlay.block=e(l.overlay.tpl),l.overlay.block.css(l.overlay.css),l.container.block=e(l.container.tpl),l.body=e(".arcticmodal-container_i2",l.container.block),i.clone?l.body.html(o.clone(!0)):(o.before('<div id="arcticmodalReserve'+l.modalID+'" style="display: none" />'),l.body.html(o)),c.prepare_body(l,o),l.closeOnOverlayClick&&l.overlay.block.add(l.container.block).click(function(t){r.isEventOut(e(">*",l.body),t)&&o.arcticmodal("close")}),l.container.block.data("arcticmodalParentEl",o),o.data("arcticmodal",l),a=e.merge(a,o),e.proxy(n.show,o)(),"html"==l.type)return o;if(void 0!=l.ajax.beforeSend){var d=l.ajax.beforeSend;delete l.ajax.beforeSend}if(void 0!=l.ajax.success){var s=l.ajax.success;delete l.ajax.success}if(void 0!=l.ajax.error){var f=l.ajax.error;delete l.ajax.error}var u=e.extend(!0,{url:l.url,beforeSend:function(){void 0==d?l.body.html('<div class="arcticmodal-loading" />'):d(l,o)},success:function(e){o.trigger("afterLoading"),l.afterLoading(l,o,e),void 0==s?l.body.html(e):s(l,o,e),c.prepare_body(l,o),o.trigger("afterLoadingOnShow"),l.afterLoadingOnShow(l,o,e)},error:function(){o.trigger("errorLoading"),l.errorLoading(l,o),void 0==f?(l.body.html(l.errors.tpl),e(".arcticmodal-error",l.body).html(l.errors.ajax_unsuccessful_load),e(".arcticmodal-close",l.body).click(function(){return o.arcticmodal("close"),!1}),l.errors.autoclose_delay&&setTimeout(function(){o.arcticmodal("close")},l.errors.autoclose_delay)):f(l,o)}},l.ajax);l.ajax_request=e.ajax(u),o.data("arcticmodal",l)}},init:function(t){if(t=e.extend(!0,{},o,t),!e.isFunction(this))return this.each(function(){c.init_el(e(this),e.extend(!0,{},t))});if(void 0==t)e.error("jquery.arcticmodal: Uncorrect parameters");else if(""==t.type)e.error('jquery.arcticmodal: Don\'t set parameter "type"');else switch(t.type){case"html":if(""==t.content){e.error('jquery.arcticmodal: Don\'t set parameter "content"');break}var a=t.content;return t.content="",c.init_el(e(a),t);case"ajax":if(""==t.url){e.error('jquery.arcticmodal: Don\'t set parameter "url"');break}return c.init_el(e("<div />"),t)}}},n={show:function(){var o=c.getParentEl(this);if(!1!==o){var t=o.data("arcticmodal");if(t.overlay.block.hide(),t.container.block.hide(),e("BODY").append(t.overlay.block),e("BODY").append(t.container.block),t.beforeOpen(t,o),o.trigger("beforeOpen"),"hidden"!=t.wrap.css("overflow")){t.wrap.data("arcticmodalOverflow",t.wrap.css("overflow"));var r=t.wrap.outerWidth(!0);t.wrap.css("overflow","hidden");var n=t.wrap.outerWidth(!0);n!=r&&t.wrap.css("marginRight",n-r+"px")}return a.not(o).each(function(){e(this).data("arcticmodal").overlay.block.hide()}),c.transition(t.overlay.block,"show",1<a.length?{type:"none"}:t.openEffect),c.transition(t.container.block,"show",1<a.length?{type:"none"}:t.openEffect,function(){t.afterOpen(t,o),o.trigger("afterOpen")}),o}e.error("jquery.arcticmodal: Uncorrect call")},close:function(){return e.isFunction(this)?void a.each(function(){e(this).arcticmodal("close")}):this.each(function(){var o=c.getParentEl(this);if(!1===o)e.error("jquery.arcticmodal: Uncorrect call");else{var t=o.data("arcticmodal");!1!==t.beforeClose(t,o)&&(o.trigger("beforeClose"),a.not(o).last().each(function(){e(this).data("arcticmodal").overlay.block.show()}),c.transition(t.overlay.block,"hide",1<a.length?{type:"none"}:t.closeEffect),c.transition(t.container.block,"hide",1<a.length?{type:"none"}:t.closeEffect,function(){t.afterClose(t,o),o.trigger("afterClose"),t.clone||e("#arcticmodalReserve"+t.modalID).replaceWith(t.body.find(">*")),t.overlay.block.remove(),t.container.block.remove(),o.data("arcticmodal",null),e(".arcticmodal-container").length||(t.wrap.data("arcticmodalOverflow")&&t.wrap.css("overflow",t.wrap.data("arcticmodalOverflow")),t.wrap.css("marginRight",0))}),"ajax"==t.type&&t.ajax_request.abort(),a=a.not(o))}})},setDefault:function(t){e.extend(!0,o,t)}};e(function(){o.wrap=e(document.all&&!document.querySelector?"html":"body")}),e(document).bind("keyup.arcticmodal",function(e){var o=a.last();o.length&&o.data("arcticmodal").closeOnEsc&&27===e.keyCode&&o.arcticmodal("close")}),e.arcticmodal=e.fn.arcticmodal=function(o){return n[o]?n[o].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==_typeof(o)&&o?void e.error("jquery.arcticmodal: Method "+o+" does not exist"):c.init.apply(this,arguments)}}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5hcmN0aWNtb2RhbC0wLjMubWluLmpzIl0sIm5hbWVzIjpbIl90eXBlb2YiLCJvYmoiLCJTeW1ib2wiLCJpdGVyYXRvciIsImNvbnN0cnVjdG9yIiwicHJvdG90eXBlIiwiZCIsImciLCJ0eXBlIiwiY29udGVudCIsInVybCIsImFqYXgiLCJhamF4X3JlcXVlc3QiLCJjbG9zZU9uRXNjIiwiY2xvc2VPbk92ZXJsYXlDbGljayIsImNsb25lIiwib3ZlcmxheSIsImJsb2NrIiwidHBsIiwiY3NzIiwiYmFja2dyb3VuZENvbG9yIiwib3BhY2l0eSIsImNvbnRhaW5lciIsIndyYXAiLCJib2R5IiwiZXJyb3JzIiwiYXV0b2Nsb3NlX2RlbGF5IiwiYWpheF91bnN1Y2Nlc3NmdWxfbG9hZCIsIm9wZW5FZmZlY3QiLCJzcGVlZCIsImNsb3NlRWZmZWN0IiwiYmVmb3JlT3BlbiIsIm5vb3AiLCJhZnRlck9wZW4iLCJiZWZvcmVDbG9zZSIsImFmdGVyQ2xvc2UiLCJhZnRlckxvYWRpbmciLCJhZnRlckxvYWRpbmdPblNob3ciLCJlcnJvckxvYWRpbmciLCJqIiwiZSIsIm0iLCJpc0V2ZW50T3V0IiwiYSIsImIiLCJjIiwiZWFjaCIsInRhcmdldCIsImdldCIsInRoaXMiLCJjbG9zZXN0IiwibGVuZ3RoIiwiZiIsImdldFBhcmVudEVsIiwiZGF0YSIsInRyYW5zaXRpb24iLCJmYWRlSW4iLCJmYWRlT3V0Iiwic2hvdyIsImhpZGUiLCJwcmVwYXJlX2JvZHkiLCJ1bmJpbmQiLCJiaW5kIiwiYXJjdGljbW9kYWwiLCJpbml0X2VsIiwibW9kYWxJRCIsImh0bWwiLCJiZWZvcmUiLCJhZGQiLCJjbGljayIsIm1lcmdlIiwicHJveHkiLCJoIiwiYmVmb3JlU2VuZCIsImsiLCJzdWNjZXNzIiwiZXJyb3IiLCJsIiwibiIsImV4dGVuZCIsInRyaWdnZXIiLCJzZXRUaW1lb3V0IiwiaW5pdCIsImlzRnVuY3Rpb24iLCJhcHBlbmQiLCJvdXRlcldpZHRoIiwibm90IiwiY2xvc2UiLCJsYXN0IiwicmVwbGFjZVdpdGgiLCJmaW5kIiwicmVtb3ZlIiwiYWJvcnQiLCJzZXREZWZhdWx0IiwiZG9jdW1lbnQiLCJhbGwiLCJxdWVyeVNlbGVjdG9yIiwia2V5Q29kZSIsImZuIiwiYXBwbHkiLCJBcnJheSIsInNsaWNlIiwiY2FsbCIsImFyZ3VtZW50cyIsImpRdWVyeSJdLCJtYXBwaW5ncyI6IkFBQUEsWUFFQSxTQUFTQSxTQUFRQyxHQUFPLHlCQUE0VSxRQUF0T0QsUUFBckQsa0JBQVhFLFNBQW9ELGdCQUFwQkEsUUFBT0MsU0FBbUMsU0FBaUJGLEdBQU8sYUFBY0EsSUFBMkIsU0FBaUJBLEdBQU8sTUFBT0EsSUFBeUIsa0JBQVhDLFNBQXlCRCxFQUFJRyxjQUFnQkYsUUFBVUQsSUFBUUMsT0FBT0csVUFBWSxlQUFrQkosS0FBeUJBLElBWW5YLFNBQVdLLEdBQ1QsR0FBSUMsSUFDRkMsS0FBTSxPQUNOQyxRQUFTLEdBQ1RDLElBQUssR0FDTEMsUUFDQUMsYUFBYyxLQUNkQyxZQUFZLEVBQ1pDLHFCQUFxQixFQUNyQkMsT0FBTyxFQUNQQyxTQUNFQyxNQUFPLE9BQ1BDLElBQUssMENBQ0xDLEtBQ0VDLGdCQUFpQixPQUNqQkMsUUFBUyxLQUdiQyxXQUNFTCxNQUFPLE9BQ1BDLElBQUssK0lBRVBLLEtBQU0sT0FDTkMsS0FBTSxPQUNOQyxRQUNFUCxJQUFLLDBEQUNMUSxnQkFBaUIsSUFDakJDLHVCQUF3QixTQUUxQkMsWUFDRXBCLEtBQU0sT0FDTnFCLE1BQU8sS0FFVEMsYUFDRXRCLEtBQU0sT0FDTnFCLE1BQU8sS0FFVEUsV0FBWXpCLEVBQUUwQixLQUNkQyxVQUFXM0IsRUFBRTBCLEtBQ2JFLFlBQWE1QixFQUFFMEIsS0FDZkcsV0FBWTdCLEVBQUUwQixLQUNkSSxhQUFjOUIsRUFBRTBCLEtBQ2hCSyxtQkFBb0IvQixFQUFFMEIsS0FDdEJNLGFBQWNoQyxFQUFFMEIsTUFFZE8sRUFBSSxFQUNKQyxFQUFJbEMsTUFDSm1DLEdBQ0ZDLFdBQVksU0FBb0JDLEVBQUdDLEdBQ2pDLEdBQUlDLElBQUksQ0FLUixPQUpBdkMsR0FBRXFDLEdBQUdHLEtBQUssV0FDUnhDLEVBQUVzQyxFQUFFRyxRQUFRQyxJQUFJLElBQU0xQyxFQUFFMkMsTUFBTUQsSUFBSSxLQUFPSCxHQUFJLEdBQzdDLEdBQUt2QyxFQUFFc0MsRUFBRUcsUUFBUUcsUUFBUSxPQUFRNUMsRUFBRTJDLE1BQU1ELElBQUksSUFBSUcsU0FBV04sR0FBSSxLQUUzREEsSUFHUE8sR0FDRkMsWUFBYSxTQUFxQlYsR0FDaEMsR0FBSUMsR0FBSXRDLEVBQUVxQyxFQUNWLE9BQU9DLEdBQUVVLEtBQUssZUFBaUJWLEtBQUtBLEVBQUl0QyxFQUFFcUMsR0FBR08sUUFBUSwwQkFBMEJJLEtBQUsseUJBQTBCVixHQUVoSFcsV0FBWSxTQUFvQlosRUFBR0MsRUFBR0MsRUFBR0wsR0FHdkMsT0FGQUEsRUFBSSxRQUFVQSxFQUFJbEMsRUFBRTBCLEtBQU9RLEVBRW5CSyxFQUFFckMsTUFDUixJQUFLLE9BQ0gsUUFBVW9DLEVBQUlELEVBQUVhLE9BQU9YLEVBQUVoQixNQUFPVyxHQUFLRyxFQUFFYyxRQUFRWixFQUFFaEIsTUFBT1csRUFDeEQsTUFFRixLQUFLLE9BQ0gsUUFBVUksRUFBSUQsRUFBRWUsT0FBU2YsRUFBRWdCLE9BQVFuQixNQUd6Q29CLGFBQWMsU0FBc0JqQixFQUFHQyxHQUNyQ3RDLEVBQUUscUJBQXNCcUMsRUFBRW5CLE1BQU1xQyxPQUFPLHFCQUFxQkMsS0FBSyxvQkFBcUIsV0FFcEYsTUFEQWxCLEdBQUVtQixZQUFZLFVBQ1AsS0FHWEMsUUFBUyxTQUFpQnJCLEVBQUdDLEdBQzNCLEdBQUlDLEdBQUlGLEVBQUVXLEtBQUssY0FFZixLQUFLVCxFQUFHLENBaUJOLEdBaEJBQSxFQUFJRCxFQUNKTCxJQUNBTSxFQUFFb0IsUUFBVTFCLEVBQ1pNLEVBQUU3QixRQUFRQyxNQUFRWCxFQUFFdUMsRUFBRTdCLFFBQVFFLEtBQzlCMkIsRUFBRTdCLFFBQVFDLE1BQU1FLElBQUkwQixFQUFFN0IsUUFBUUcsS0FDOUIwQixFQUFFdkIsVUFBVUwsTUFBUVgsRUFBRXVDLEVBQUV2QixVQUFVSixLQUNsQzJCLEVBQUVyQixLQUFPbEIsRUFBRSw0QkFBNkJ1QyxFQUFFdkIsVUFBVUwsT0FDcEQyQixFQUFFN0IsTUFBUThCLEVBQUVyQixLQUFLMEMsS0FBS3ZCLEVBQUU1QixPQUFNLEtBQVE0QixFQUFFd0IsT0FBTyw4QkFBZ0N0QixFQUFFb0IsUUFBVSw4QkFBK0JwQixFQUFFckIsS0FBSzBDLEtBQUt2QixJQUN0SVMsRUFBRVEsYUFBYWYsRUFBR0YsR0FDbEJFLEVBQUUvQixxQkFBdUIrQixFQUFFN0IsUUFBUUMsTUFBTW1ELElBQUl2QixFQUFFdkIsVUFBVUwsT0FBT29ELE1BQU0sU0FBVXpCLEdBQzlFSCxFQUFFQyxXQUFXcEMsRUFBRSxLQUFNdUMsRUFBRXJCLE1BQU9vQixJQUFNRCxFQUFFb0IsWUFBWSxXQUVwRGxCLEVBQUV2QixVQUFVTCxNQUFNcUMsS0FBSyxzQkFBdUJYLEdBQzlDQSxFQUFFVyxLQUFLLGNBQWVULEdBQ3RCTCxFQUFJbEMsRUFBRWdFLE1BQU05QixFQUFHRyxHQUNmckMsRUFBRWlFLE1BQU1DLEVBQUVkLEtBQU1mLEtBQ1osUUFBVUUsRUFBRXJDLEtBQU0sTUFBT21DLEVBRTdCLElBQUksUUFBVUUsRUFBRWxDLEtBQUs4RCxXQUFZLENBQy9CLEdBQUlDLEdBQUk3QixFQUFFbEMsS0FBSzhELGlCQUNSNUIsR0FBRWxDLEtBQUs4RCxXQUdoQixHQUFJLFFBQVU1QixFQUFFbEMsS0FBS2dFLFFBQVMsQ0FDNUIsR0FBSXBFLEdBQUlzQyxFQUFFbEMsS0FBS2dFLGNBQ1I5QixHQUFFbEMsS0FBS2dFLFFBR2hCLEdBQUksUUFBVTlCLEVBQUVsQyxLQUFLaUUsTUFBTyxDQUMxQixHQUFJQyxHQUFJaEMsRUFBRWxDLEtBQUtpRSxZQUNSL0IsR0FBRWxDLEtBQUtpRSxNQUdoQixHQUFJRSxHQUFJeEUsRUFBRXlFLFFBQU8sR0FDZnJFLElBQUttQyxFQUFFbkMsSUFDUCtELFdBQVksV0FDVixRQUFVQyxFQUFJN0IsRUFBRXJCLEtBQUswQyxLQUFLLHVDQUF5Q1EsRUFBRTdCLEVBQUdGLElBRTFFZ0MsUUFBUyxTQUFpQi9CLEdBQ3hCRCxFQUFFcUMsUUFBUSxnQkFDVm5DLEVBQUVULGFBQWFTLEVBQUdGLEVBQUdDLEdBQ3JCLFFBQVVyQyxFQUFJc0MsRUFBRXJCLEtBQUswQyxLQUFLdEIsR0FBS3JDLEVBQUVzQyxFQUFHRixFQUFHQyxHQUN2Q1EsRUFBRVEsYUFBYWYsRUFBR0YsR0FDbEJBLEVBQUVxQyxRQUFRLHNCQUNWbkMsRUFBRVIsbUJBQW1CUSxFQUFHRixFQUFHQyxJQUU3QmdDLE1BQU8sV0FDTGpDLEVBQUVxQyxRQUFRLGdCQUNWbkMsRUFBRVAsYUFBYU8sRUFBR0YsR0FDbEIsUUFBVWtDLEdBQUtoQyxFQUFFckIsS0FBSzBDLEtBQUtyQixFQUFFcEIsT0FBT1AsS0FBTVosRUFBRSxxQkFBc0J1QyxFQUFFckIsTUFBTTBDLEtBQUtyQixFQUFFcEIsT0FBT0Usd0JBQXlCckIsRUFBRSxxQkFBc0J1QyxFQUFFckIsTUFBTTZDLE1BQU0sV0FFckosTUFEQTFCLEdBQUVvQixZQUFZLFVBQ1AsSUFDTGxCLEVBQUVwQixPQUFPQyxpQkFBbUJ1RCxXQUFXLFdBQ3pDdEMsRUFBRW9CLFlBQVksVUFDYmxCLEVBQUVwQixPQUFPQyxrQkFBb0JtRCxFQUFFaEMsRUFBR0YsS0FFdENFLEVBQUVsQyxLQUNMa0MsR0FBRWpDLGFBQWVOLEVBQUVLLEtBQUttRSxHQUN4Qm5DLEVBQUVXLEtBQUssY0FBZVQsS0FHMUJxQyxLQUFNLFNBQWN2QyxHQUVsQixHQURBQSxFQUFJckMsRUFBRXlFLFFBQU8sS0FBUXhFLEVBQUdvQyxJQUNwQnJDLEVBQUU2RSxXQUFXbEMsTUFvQlYsTUFBT0EsTUFBS0gsS0FBSyxXQUN0Qk0sRUFBRVksUUFBUTFELEVBQUUyQyxNQUFPM0MsRUFBRXlFLFFBQU8sS0FBUXBDLEtBcEJwQyxJQUFJLFFBQVVBLEVBQUdyQyxFQUFFc0UsTUFBTSxnREFBaUQsSUFBSSxJQUFNakMsRUFBRW5DLEtBQU1GLEVBQUVzRSxNQUFNLHVEQUF3RCxRQUFRakMsRUFBRW5DLE1BQ3BLLElBQUssT0FDSCxHQUFJLElBQU1tQyxFQUFFbEMsUUFBUyxDQUNuQkgsRUFBRXNFLE1BQU0scURBQ1IsT0FHRixHQUFJaEMsR0FBSUQsRUFBRWxDLE9BRVYsT0FEQWtDLEdBQUVsQyxRQUFVLEdBQ0wyQyxFQUFFWSxRQUFRMUQsRUFBRXNDLEdBQUlELEVBRXpCLEtBQUssT0FDSCxHQUFJLElBQU1BLEVBQUVqQyxJQUFLLENBQ2ZKLEVBQUVzRSxNQUFNLGlEQUNSLE9BR0YsTUFBT3hCLEdBQUVZLFFBQVExRCxFQUFFLFdBQVlxQyxNQU9yQzZCLEdBQ0ZkLEtBQU0sV0FDSixHQUFJZixHQUFJUyxFQUFFQyxZQUFZSixLQUN0QixLQUFJLElBQU9OLEVBQXNELENBQy9ELEdBQUlDLEdBQUlELEVBQUVXLEtBQUssY0FRZixJQVBBVixFQUFFNUIsUUFBUUMsTUFBTTBDLE9BQ2hCZixFQUFFdEIsVUFBVUwsTUFBTTBDLE9BQ2xCckQsRUFBRSxRQUFROEUsT0FBT3hDLEVBQUU1QixRQUFRQyxPQUMzQlgsRUFBRSxRQUFROEUsT0FBT3hDLEVBQUV0QixVQUFVTCxPQUM3QjJCLEVBQUViLFdBQVdhLEVBQUdELEdBQ2hCQSxFQUFFcUMsUUFBUSxjQUVOLFVBQVlwQyxFQUFFckIsS0FBS0osSUFBSSxZQUFhLENBQ3RDeUIsRUFBRXJCLEtBQUsrQixLQUFLLHNCQUF1QlYsRUFBRXJCLEtBQUtKLElBQUksWUFDOUMsSUFBSTBCLEdBQUlELEVBQUVyQixLQUFLOEQsWUFBVyxFQUMxQnpDLEdBQUVyQixLQUFLSixJQUFJLFdBQVksU0FDdkIsSUFBSVosR0FBSXFDLEVBQUVyQixLQUFLOEQsWUFBVyxFQUMxQjlFLElBQUtzQyxHQUFLRCxFQUFFckIsS0FBS0osSUFBSSxjQUFlWixFQUFJc0MsRUFBSSxNQWU5QyxNQVpBTCxHQUFFOEMsSUFBSTNDLEdBQUdHLEtBQUssV0FDWnhDLEVBQUUyQyxNQUFNSyxLQUFLLGVBQWV0QyxRQUFRQyxNQUFNMEMsU0FFNUNQLEVBQUVHLFdBQVdYLEVBQUU1QixRQUFRQyxNQUFPLE9BQVEsRUFBSXVCLEVBQUVXLFFBQzFDM0MsS0FBTSxRQUNKb0MsRUFBRWhCLFlBQ053QixFQUFFRyxXQUFXWCxFQUFFdEIsVUFBVUwsTUFBTyxPQUFRLEVBQUl1QixFQUFFVyxRQUM1QzNDLEtBQU0sUUFDSm9DLEVBQUVoQixXQUFZLFdBQ2hCZ0IsRUFBRVgsVUFBVVcsRUFBR0QsR0FDZkEsRUFBRXFDLFFBQVEsZUFFTHJDLEVBN0JLckMsRUFBRXNFLE1BQU0sdUNBZ0N4QlcsTUFBTyxXQUNMLE1BQUlqRixHQUFFNkUsV0FBV2xDLFVBQU9ULEdBQUVNLEtBQUssV0FDN0J4QyxFQUFFMkMsTUFBTWMsWUFBWSxXQUNQZCxLQUFLSCxLQUFLLFdBQ3ZCLEdBQUlILEdBQUlTLEVBQUVDLFlBQVlKLEtBQ3RCLEtBQUksSUFBT04sRUFBR3JDLEVBQUVzRSxNQUFNLDBDQUEyQyxDQUMvRCxHQUFJaEMsR0FBSUQsRUFBRVcsS0FBSyxnQkFDZixJQUFPVixFQUFFVixZQUFZVSxFQUFHRCxLQUFPQSxFQUFFcUMsUUFBUSxlQUFnQnhDLEVBQUU4QyxJQUFJM0MsR0FBRzZDLE9BQU8xQyxLQUFLLFdBQzVFeEMsRUFBRTJDLE1BQU1LLEtBQUssZUFBZXRDLFFBQVFDLE1BQU15QyxTQUN4Q04sRUFBRUcsV0FBV1gsRUFBRTVCLFFBQVFDLE1BQU8sT0FBUSxFQUFJdUIsRUFBRVcsUUFDOUMzQyxLQUFNLFFBQ0pvQyxFQUFFZCxhQUFjc0IsRUFBRUcsV0FBV1gsRUFBRXRCLFVBQVVMLE1BQU8sT0FBUSxFQUFJdUIsRUFBRVcsUUFDaEUzQyxLQUFNLFFBQ0pvQyxFQUFFZCxZQUFhLFdBQ2pCYyxFQUFFVCxXQUFXUyxFQUFHRCxHQUNoQkEsRUFBRXFDLFFBQVEsY0FDVnBDLEVBQUU3QixPQUFTVCxFQUFFLHNCQUF3QnNDLEVBQUVxQixTQUFTd0IsWUFBWTdDLEVBQUVwQixLQUFLa0UsS0FBSyxPQUN4RTlDLEVBQUU1QixRQUFRQyxNQUFNMEUsU0FDaEIvQyxFQUFFdEIsVUFBVUwsTUFBTTBFLFNBQ2xCaEQsRUFBRVcsS0FBSyxjQUFlLE1BQ3RCaEQsRUFBRSwwQkFBMEI2QyxTQUFXUCxFQUFFckIsS0FBSytCLEtBQUssd0JBQTBCVixFQUFFckIsS0FBS0osSUFBSSxXQUFZeUIsRUFBRXJCLEtBQUsrQixLQUFLLHdCQUF5QlYsRUFBRXJCLEtBQUtKLElBQUksY0FBZSxNQUNqSyxRQUFVeUIsRUFBRXBDLE1BQVFvQyxFQUFFaEMsYUFBYWdGLFFBQVNwRCxFQUFJQSxFQUFFOEMsSUFBSTNDLFFBSWhFa0QsV0FBWSxTQUFvQmxELEdBQzlCckMsRUFBRXlFLFFBQU8sRUFBSXhFLEVBQUdvQyxJQUdwQnJDLEdBQUUsV0FDQUMsRUFBRWdCLEtBQU9qQixFQUFFd0YsU0FBU0MsTUFBUUQsU0FBU0UsY0FBZ0IsT0FBUyxVQUVoRTFGLEVBQUV3RixVQUFVaEMsS0FBSyxvQkFBcUIsU0FBVW5CLEdBQzlDLEdBQUlDLEdBQUlKLEVBQUVnRCxNQUNWNUMsR0FBRU8sUUFBVVAsRUFBRVUsS0FBSyxlQUFlekMsWUFBYyxLQUFPOEIsRUFBRXNELFNBQVdyRCxFQUFFbUIsWUFBWSxXQUdwRnpELEVBQUV5RCxZQUFjekQsRUFBRTRGLEdBQUduQyxZQUFjLFNBQVVwQixHQUMzQyxNQUFJNkIsR0FBRTdCLEdBQVc2QixFQUFFN0IsR0FBR3dELE1BQU1sRCxLQUFNbUQsTUFBTS9GLFVBQVVnRyxNQUFNQyxLQUFLQyxVQUFXLElBQ3BFLFdBQWF2RyxRQUFRMkMsSUFBT0EsTUFDaENyQyxHQUFFc0UsTUFBTSw4QkFBZ0NqQyxFQUFJLG1CQURGUyxFQUFFOEIsS0FBS2lCLE1BQU1sRCxLQUFNc0QsYUFHOURDIiwiZmlsZSI6ImpxdWVyeS5hcmN0aWNtb2RhbC0wLjMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IFwiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2ZcIjsgaWYgKHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSBcInN5bWJvbFwiKSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfTsgfSBlbHNlIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH1cblxuLypcclxuXHJcbiBhcmN0aWNNb2RhbCDigJQgalF1ZXJ5IHBsdWdpblxyXG4gVmVyc2lvbjogMC4zXHJcbiBBdXRob3I6IFNlcmdleSBQcmVkdm9kaXRlbGV2IChzZXJnZXkucHJlZHZvZGl0ZWxldkBnbWFpbC5jb20pXHJcbiBDb21wYW55OiBBcmN0aWMgTGFib3JhdG9yeSAoaHR0cDovL2FyY3RpY2xhYi5ydS8pXHJcblxyXG4gRG9jcyAmIEV4YW1wbGVzOiBodHRwOi8vYXJjdGljbGFiLnJ1L2FyY3RpY21vZGFsL1xyXG5cclxuICovXG4oZnVuY3Rpb24gKGQpIHtcbiAgdmFyIGcgPSB7XG4gICAgdHlwZTogXCJodG1sXCIsXG4gICAgY29udGVudDogXCJcIixcbiAgICB1cmw6IFwiXCIsXG4gICAgYWpheDoge30sXG4gICAgYWpheF9yZXF1ZXN0OiBudWxsLFxuICAgIGNsb3NlT25Fc2M6ICEwLFxuICAgIGNsb3NlT25PdmVybGF5Q2xpY2s6ICEwLFxuICAgIGNsb25lOiAhMSxcbiAgICBvdmVybGF5OiB7XG4gICAgICBibG9jazogdm9pZCAwLFxuICAgICAgdHBsOiAnPGRpdiBjbGFzcz1cImFyY3RpY21vZGFsLW92ZXJsYXlcIj48L2Rpdj4nLFxuICAgICAgY3NzOiB7XG4gICAgICAgIGJhY2tncm91bmRDb2xvcjogXCIjMDAwXCIsXG4gICAgICAgIG9wYWNpdHk6IDAuNlxuICAgICAgfVxuICAgIH0sXG4gICAgY29udGFpbmVyOiB7XG4gICAgICBibG9jazogdm9pZCAwLFxuICAgICAgdHBsOiAnPGRpdiBjbGFzcz1cImFyY3RpY21vZGFsLWNvbnRhaW5lclwiPjx0YWJsZSBjbGFzcz1cImFyY3RpY21vZGFsLWNvbnRhaW5lcl9pXCI+PHRyPjx0ZCBjbGFzcz1cImFyY3RpY21vZGFsLWNvbnRhaW5lcl9pMlwiPjwvdGQ+PC90cj48L3RhYmxlPjwvZGl2PidcbiAgICB9LFxuICAgIHdyYXA6IHZvaWQgMCxcbiAgICBib2R5OiB2b2lkIDAsXG4gICAgZXJyb3JzOiB7XG4gICAgICB0cGw6ICc8ZGl2IGNsYXNzPVwiYXJjdGljbW9kYWwtZXJyb3IgYXJjdGljbW9kYWwtY2xvc2VcIj48L2Rpdj4nLFxuICAgICAgYXV0b2Nsb3NlX2RlbGF5OiAyRTMsXG4gICAgICBhamF4X3Vuc3VjY2Vzc2Z1bF9sb2FkOiBcIkVycm9yXCJcbiAgICB9LFxuICAgIG9wZW5FZmZlY3Q6IHtcbiAgICAgIHR5cGU6IFwiZmFkZVwiLFxuICAgICAgc3BlZWQ6IDQwMFxuICAgIH0sXG4gICAgY2xvc2VFZmZlY3Q6IHtcbiAgICAgIHR5cGU6IFwiZmFkZVwiLFxuICAgICAgc3BlZWQ6IDQwMFxuICAgIH0sXG4gICAgYmVmb3JlT3BlbjogZC5ub29wLFxuICAgIGFmdGVyT3BlbjogZC5ub29wLFxuICAgIGJlZm9yZUNsb3NlOiBkLm5vb3AsXG4gICAgYWZ0ZXJDbG9zZTogZC5ub29wLFxuICAgIGFmdGVyTG9hZGluZzogZC5ub29wLFxuICAgIGFmdGVyTG9hZGluZ09uU2hvdzogZC5ub29wLFxuICAgIGVycm9yTG9hZGluZzogZC5ub29wXG4gIH0sXG4gICAgICBqID0gMCxcbiAgICAgIGUgPSBkKFtdKSxcbiAgICAgIG0gPSB7XG4gICAgaXNFdmVudE91dDogZnVuY3Rpb24gaXNFdmVudE91dChhLCBiKSB7XG4gICAgICB2YXIgYyA9ICEwO1xuICAgICAgZChhKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZChiLnRhcmdldCkuZ2V0KDApID09IGQodGhpcykuZ2V0KDApICYmIChjID0gITEpO1xuICAgICAgICAwID09IGQoYi50YXJnZXQpLmNsb3Nlc3QoXCJIVE1MXCIsIGQodGhpcykuZ2V0KDApKS5sZW5ndGggJiYgKGMgPSAhMSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBjO1xuICAgIH1cbiAgfSxcbiAgICAgIGYgPSB7XG4gICAgZ2V0UGFyZW50RWw6IGZ1bmN0aW9uIGdldFBhcmVudEVsKGEpIHtcbiAgICAgIHZhciBiID0gZChhKTtcbiAgICAgIHJldHVybiBiLmRhdGEoXCJhcmN0aWNtb2RhbFwiKSA/IGIgOiAoYiA9IGQoYSkuY2xvc2VzdChcIi5hcmN0aWNtb2RhbC1jb250YWluZXJcIikuZGF0YShcImFyY3RpY21vZGFsUGFyZW50RWxcIikpID8gYiA6ICExO1xuICAgIH0sXG4gICAgdHJhbnNpdGlvbjogZnVuY3Rpb24gdHJhbnNpdGlvbihhLCBiLCBjLCBlKSB7XG4gICAgICBlID0gdm9pZCAwID09IGUgPyBkLm5vb3AgOiBlO1xuXG4gICAgICBzd2l0Y2ggKGMudHlwZSkge1xuICAgICAgICBjYXNlIFwiZmFkZVwiOlxuICAgICAgICAgIFwic2hvd1wiID09IGIgPyBhLmZhZGVJbihjLnNwZWVkLCBlKSA6IGEuZmFkZU91dChjLnNwZWVkLCBlKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlIFwibm9uZVwiOlxuICAgICAgICAgIFwic2hvd1wiID09IGIgPyBhLnNob3coKSA6IGEuaGlkZSgpLCBlKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBwcmVwYXJlX2JvZHk6IGZ1bmN0aW9uIHByZXBhcmVfYm9keShhLCBiKSB7XG4gICAgICBkKFwiLmFyY3RpY21vZGFsLWNsb3NlXCIsIGEuYm9keSkudW5iaW5kKFwiY2xpY2suYXJjdGljbW9kYWxcIikuYmluZChcImNsaWNrLmFyY3RpY21vZGFsXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYi5hcmN0aWNtb2RhbChcImNsb3NlXCIpO1xuICAgICAgICByZXR1cm4gITE7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGluaXRfZWw6IGZ1bmN0aW9uIGluaXRfZWwoYSwgYikge1xuICAgICAgdmFyIGMgPSBhLmRhdGEoXCJhcmN0aWNtb2RhbFwiKTtcblxuICAgICAgaWYgKCFjKSB7XG4gICAgICAgIGMgPSBiO1xuICAgICAgICBqKys7XG4gICAgICAgIGMubW9kYWxJRCA9IGo7XG4gICAgICAgIGMub3ZlcmxheS5ibG9jayA9IGQoYy5vdmVybGF5LnRwbCk7XG4gICAgICAgIGMub3ZlcmxheS5ibG9jay5jc3MoYy5vdmVybGF5LmNzcyk7XG4gICAgICAgIGMuY29udGFpbmVyLmJsb2NrID0gZChjLmNvbnRhaW5lci50cGwpO1xuICAgICAgICBjLmJvZHkgPSBkKFwiLmFyY3RpY21vZGFsLWNvbnRhaW5lcl9pMlwiLCBjLmNvbnRhaW5lci5ibG9jayk7XG4gICAgICAgIGIuY2xvbmUgPyBjLmJvZHkuaHRtbChhLmNsb25lKCEwKSkgOiAoYS5iZWZvcmUoJzxkaXYgaWQ9XCJhcmN0aWNtb2RhbFJlc2VydmUnICsgYy5tb2RhbElEICsgJ1wiIHN0eWxlPVwiZGlzcGxheTogbm9uZVwiIC8+JyksIGMuYm9keS5odG1sKGEpKTtcbiAgICAgICAgZi5wcmVwYXJlX2JvZHkoYywgYSk7XG4gICAgICAgIGMuY2xvc2VPbk92ZXJsYXlDbGljayAmJiBjLm92ZXJsYXkuYmxvY2suYWRkKGMuY29udGFpbmVyLmJsb2NrKS5jbGljayhmdW5jdGlvbiAoYikge1xuICAgICAgICAgIG0uaXNFdmVudE91dChkKFwiPipcIiwgYy5ib2R5KSwgYikgJiYgYS5hcmN0aWNtb2RhbChcImNsb3NlXCIpO1xuICAgICAgICB9KTtcbiAgICAgICAgYy5jb250YWluZXIuYmxvY2suZGF0YShcImFyY3RpY21vZGFsUGFyZW50RWxcIiwgYSk7XG4gICAgICAgIGEuZGF0YShcImFyY3RpY21vZGFsXCIsIGMpO1xuICAgICAgICBlID0gZC5tZXJnZShlLCBhKTtcbiAgICAgICAgZC5wcm94eShoLnNob3csIGEpKCk7XG4gICAgICAgIGlmIChcImh0bWxcIiA9PSBjLnR5cGUpIHJldHVybiBhO1xuXG4gICAgICAgIGlmICh2b2lkIDAgIT0gYy5hamF4LmJlZm9yZVNlbmQpIHtcbiAgICAgICAgICB2YXIgayA9IGMuYWpheC5iZWZvcmVTZW5kO1xuICAgICAgICAgIGRlbGV0ZSBjLmFqYXguYmVmb3JlU2VuZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh2b2lkIDAgIT0gYy5hamF4LnN1Y2Nlc3MpIHtcbiAgICAgICAgICB2YXIgZyA9IGMuYWpheC5zdWNjZXNzO1xuICAgICAgICAgIGRlbGV0ZSBjLmFqYXguc3VjY2VzcztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh2b2lkIDAgIT0gYy5hamF4LmVycm9yKSB7XG4gICAgICAgICAgdmFyIGwgPSBjLmFqYXguZXJyb3I7XG4gICAgICAgICAgZGVsZXRlIGMuYWpheC5lcnJvcjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBuID0gZC5leHRlbmQoITAsIHtcbiAgICAgICAgICB1cmw6IGMudXJsLFxuICAgICAgICAgIGJlZm9yZVNlbmQ6IGZ1bmN0aW9uIGJlZm9yZVNlbmQoKSB7XG4gICAgICAgICAgICB2b2lkIDAgPT0gayA/IGMuYm9keS5odG1sKCc8ZGl2IGNsYXNzPVwiYXJjdGljbW9kYWwtbG9hZGluZ1wiIC8+JykgOiBrKGMsIGEpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gc3VjY2VzcyhiKSB7XG4gICAgICAgICAgICBhLnRyaWdnZXIoXCJhZnRlckxvYWRpbmdcIik7XG4gICAgICAgICAgICBjLmFmdGVyTG9hZGluZyhjLCBhLCBiKTtcbiAgICAgICAgICAgIHZvaWQgMCA9PSBnID8gYy5ib2R5Lmh0bWwoYikgOiBnKGMsIGEsIGIpO1xuICAgICAgICAgICAgZi5wcmVwYXJlX2JvZHkoYywgYSk7XG4gICAgICAgICAgICBhLnRyaWdnZXIoXCJhZnRlckxvYWRpbmdPblNob3dcIik7XG4gICAgICAgICAgICBjLmFmdGVyTG9hZGluZ09uU2hvdyhjLCBhLCBiKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiBlcnJvcigpIHtcbiAgICAgICAgICAgIGEudHJpZ2dlcihcImVycm9yTG9hZGluZ1wiKTtcbiAgICAgICAgICAgIGMuZXJyb3JMb2FkaW5nKGMsIGEpO1xuICAgICAgICAgICAgdm9pZCAwID09IGwgPyAoYy5ib2R5Lmh0bWwoYy5lcnJvcnMudHBsKSwgZChcIi5hcmN0aWNtb2RhbC1lcnJvclwiLCBjLmJvZHkpLmh0bWwoYy5lcnJvcnMuYWpheF91bnN1Y2Nlc3NmdWxfbG9hZCksIGQoXCIuYXJjdGljbW9kYWwtY2xvc2VcIiwgYy5ib2R5KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGEuYXJjdGljbW9kYWwoXCJjbG9zZVwiKTtcbiAgICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICAgICAgfSksIGMuZXJyb3JzLmF1dG9jbG9zZV9kZWxheSAmJiBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgYS5hcmN0aWNtb2RhbChcImNsb3NlXCIpO1xuICAgICAgICAgICAgfSwgYy5lcnJvcnMuYXV0b2Nsb3NlX2RlbGF5KSkgOiBsKGMsIGEpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgYy5hamF4KTtcbiAgICAgICAgYy5hamF4X3JlcXVlc3QgPSBkLmFqYXgobik7XG4gICAgICAgIGEuZGF0YShcImFyY3RpY21vZGFsXCIsIGMpO1xuICAgICAgfVxuICAgIH0sXG4gICAgaW5pdDogZnVuY3Rpb24gaW5pdChhKSB7XG4gICAgICBhID0gZC5leHRlbmQoITAsIHt9LCBnLCBhKTtcbiAgICAgIGlmIChkLmlzRnVuY3Rpb24odGhpcykpIHtcbiAgICAgICAgaWYgKHZvaWQgMCA9PSBhKSBkLmVycm9yKFwianF1ZXJ5LmFyY3RpY21vZGFsOiBVbmNvcnJlY3QgcGFyYW1ldGVyc1wiKTtlbHNlIGlmIChcIlwiID09IGEudHlwZSkgZC5lcnJvcignanF1ZXJ5LmFyY3RpY21vZGFsOiBEb25cXCd0IHNldCBwYXJhbWV0ZXIgXCJ0eXBlXCInKTtlbHNlIHN3aXRjaCAoYS50eXBlKSB7XG4gICAgICAgICAgY2FzZSBcImh0bWxcIjpcbiAgICAgICAgICAgIGlmIChcIlwiID09IGEuY29udGVudCkge1xuICAgICAgICAgICAgICBkLmVycm9yKCdqcXVlcnkuYXJjdGljbW9kYWw6IERvblxcJ3Qgc2V0IHBhcmFtZXRlciBcImNvbnRlbnRcIicpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGIgPSBhLmNvbnRlbnQ7XG4gICAgICAgICAgICBhLmNvbnRlbnQgPSBcIlwiO1xuICAgICAgICAgICAgcmV0dXJuIGYuaW5pdF9lbChkKGIpLCBhKTtcblxuICAgICAgICAgIGNhc2UgXCJhamF4XCI6XG4gICAgICAgICAgICBpZiAoXCJcIiA9PSBhLnVybCkge1xuICAgICAgICAgICAgICBkLmVycm9yKCdqcXVlcnkuYXJjdGljbW9kYWw6IERvblxcJ3Qgc2V0IHBhcmFtZXRlciBcInVybFwiJyk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZi5pbml0X2VsKGQoXCI8ZGl2IC8+XCIpLCBhKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICBmLmluaXRfZWwoZCh0aGlzKSwgZC5leHRlbmQoITAsIHt9LCBhKSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gICAgICBoID0ge1xuICAgIHNob3c6IGZ1bmN0aW9uIHNob3coKSB7XG4gICAgICB2YXIgYSA9IGYuZ2V0UGFyZW50RWwodGhpcyk7XG4gICAgICBpZiAoITEgPT09IGEpIGQuZXJyb3IoXCJqcXVlcnkuYXJjdGljbW9kYWw6IFVuY29ycmVjdCBjYWxsXCIpO2Vsc2Uge1xuICAgICAgICB2YXIgYiA9IGEuZGF0YShcImFyY3RpY21vZGFsXCIpO1xuICAgICAgICBiLm92ZXJsYXkuYmxvY2suaGlkZSgpO1xuICAgICAgICBiLmNvbnRhaW5lci5ibG9jay5oaWRlKCk7XG4gICAgICAgIGQoXCJCT0RZXCIpLmFwcGVuZChiLm92ZXJsYXkuYmxvY2spO1xuICAgICAgICBkKFwiQk9EWVwiKS5hcHBlbmQoYi5jb250YWluZXIuYmxvY2spO1xuICAgICAgICBiLmJlZm9yZU9wZW4oYiwgYSk7XG4gICAgICAgIGEudHJpZ2dlcihcImJlZm9yZU9wZW5cIik7XG5cbiAgICAgICAgaWYgKFwiaGlkZGVuXCIgIT0gYi53cmFwLmNzcyhcIm92ZXJmbG93XCIpKSB7XG4gICAgICAgICAgYi53cmFwLmRhdGEoXCJhcmN0aWNtb2RhbE92ZXJmbG93XCIsIGIud3JhcC5jc3MoXCJvdmVyZmxvd1wiKSk7XG4gICAgICAgICAgdmFyIGMgPSBiLndyYXAub3V0ZXJXaWR0aCghMCk7XG4gICAgICAgICAgYi53cmFwLmNzcyhcIm92ZXJmbG93XCIsIFwiaGlkZGVuXCIpO1xuICAgICAgICAgIHZhciBnID0gYi53cmFwLm91dGVyV2lkdGgoITApO1xuICAgICAgICAgIGcgIT0gYyAmJiBiLndyYXAuY3NzKFwibWFyZ2luUmlnaHRcIiwgZyAtIGMgKyBcInB4XCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgZS5ub3QoYSkuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZCh0aGlzKS5kYXRhKFwiYXJjdGljbW9kYWxcIikub3ZlcmxheS5ibG9jay5oaWRlKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBmLnRyYW5zaXRpb24oYi5vdmVybGF5LmJsb2NrLCBcInNob3dcIiwgMSA8IGUubGVuZ3RoID8ge1xuICAgICAgICAgIHR5cGU6IFwibm9uZVwiXG4gICAgICAgIH0gOiBiLm9wZW5FZmZlY3QpO1xuICAgICAgICBmLnRyYW5zaXRpb24oYi5jb250YWluZXIuYmxvY2ssIFwic2hvd1wiLCAxIDwgZS5sZW5ndGggPyB7XG4gICAgICAgICAgdHlwZTogXCJub25lXCJcbiAgICAgICAgfSA6IGIub3BlbkVmZmVjdCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGIuYWZ0ZXJPcGVuKGIsIGEpO1xuICAgICAgICAgIGEudHJpZ2dlcihcImFmdGVyT3BlblwiKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBhO1xuICAgICAgfVxuICAgIH0sXG4gICAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKCkge1xuICAgICAgaWYgKGQuaXNGdW5jdGlvbih0aGlzKSkgZS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZCh0aGlzKS5hcmN0aWNtb2RhbChcImNsb3NlXCIpO1xuICAgICAgfSk7ZWxzZSByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGEgPSBmLmdldFBhcmVudEVsKHRoaXMpO1xuICAgICAgICBpZiAoITEgPT09IGEpIGQuZXJyb3IoXCJqcXVlcnkuYXJjdGljbW9kYWw6IFVuY29ycmVjdCBjYWxsXCIpO2Vsc2Uge1xuICAgICAgICAgIHZhciBiID0gYS5kYXRhKFwiYXJjdGljbW9kYWxcIik7XG4gICAgICAgICAgITEgIT09IGIuYmVmb3JlQ2xvc2UoYiwgYSkgJiYgKGEudHJpZ2dlcihcImJlZm9yZUNsb3NlXCIpLCBlLm5vdChhKS5sYXN0KCkuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkKHRoaXMpLmRhdGEoXCJhcmN0aWNtb2RhbFwiKS5vdmVybGF5LmJsb2NrLnNob3coKTtcbiAgICAgICAgICB9KSwgZi50cmFuc2l0aW9uKGIub3ZlcmxheS5ibG9jaywgXCJoaWRlXCIsIDEgPCBlLmxlbmd0aCA/IHtcbiAgICAgICAgICAgIHR5cGU6IFwibm9uZVwiXG4gICAgICAgICAgfSA6IGIuY2xvc2VFZmZlY3QpLCBmLnRyYW5zaXRpb24oYi5jb250YWluZXIuYmxvY2ssIFwiaGlkZVwiLCAxIDwgZS5sZW5ndGggPyB7XG4gICAgICAgICAgICB0eXBlOiBcIm5vbmVcIlxuICAgICAgICAgIH0gOiBiLmNsb3NlRWZmZWN0LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBiLmFmdGVyQ2xvc2UoYiwgYSk7XG4gICAgICAgICAgICBhLnRyaWdnZXIoXCJhZnRlckNsb3NlXCIpO1xuICAgICAgICAgICAgYi5jbG9uZSB8fCBkKFwiI2FyY3RpY21vZGFsUmVzZXJ2ZVwiICsgYi5tb2RhbElEKS5yZXBsYWNlV2l0aChiLmJvZHkuZmluZChcIj4qXCIpKTtcbiAgICAgICAgICAgIGIub3ZlcmxheS5ibG9jay5yZW1vdmUoKTtcbiAgICAgICAgICAgIGIuY29udGFpbmVyLmJsb2NrLnJlbW92ZSgpO1xuICAgICAgICAgICAgYS5kYXRhKFwiYXJjdGljbW9kYWxcIiwgbnVsbCk7XG4gICAgICAgICAgICBkKFwiLmFyY3RpY21vZGFsLWNvbnRhaW5lclwiKS5sZW5ndGggfHwgKGIud3JhcC5kYXRhKFwiYXJjdGljbW9kYWxPdmVyZmxvd1wiKSAmJiBiLndyYXAuY3NzKFwib3ZlcmZsb3dcIiwgYi53cmFwLmRhdGEoXCJhcmN0aWNtb2RhbE92ZXJmbG93XCIpKSwgYi53cmFwLmNzcyhcIm1hcmdpblJpZ2h0XCIsIDApKTtcbiAgICAgICAgICB9KSwgXCJhamF4XCIgPT0gYi50eXBlICYmIGIuYWpheF9yZXF1ZXN0LmFib3J0KCksIGUgPSBlLm5vdChhKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgc2V0RGVmYXVsdDogZnVuY3Rpb24gc2V0RGVmYXVsdChhKSB7XG4gICAgICBkLmV4dGVuZCghMCwgZywgYSk7XG4gICAgfVxuICB9O1xuICBkKGZ1bmN0aW9uICgpIHtcbiAgICBnLndyYXAgPSBkKGRvY3VtZW50LmFsbCAmJiAhZG9jdW1lbnQucXVlcnlTZWxlY3RvciA/IFwiaHRtbFwiIDogXCJib2R5XCIpO1xuICB9KTtcbiAgZChkb2N1bWVudCkuYmluZChcImtleXVwLmFyY3RpY21vZGFsXCIsIGZ1bmN0aW9uIChhKSB7XG4gICAgdmFyIGIgPSBlLmxhc3QoKTtcbiAgICBiLmxlbmd0aCAmJiBiLmRhdGEoXCJhcmN0aWNtb2RhbFwiKS5jbG9zZU9uRXNjICYmIDI3ID09PSBhLmtleUNvZGUgJiYgYi5hcmN0aWNtb2RhbChcImNsb3NlXCIpO1xuICB9KTtcblxuICBkLmFyY3RpY21vZGFsID0gZC5mbi5hcmN0aWNtb2RhbCA9IGZ1bmN0aW9uIChhKSB7XG4gICAgaWYgKGhbYV0pIHJldHVybiBoW2FdLmFwcGx5KHRoaXMsIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpO1xuICAgIGlmIChcIm9iamVjdFwiID09PSBfdHlwZW9mKGEpIHx8ICFhKSByZXR1cm4gZi5pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgZC5lcnJvcihcImpxdWVyeS5hcmN0aWNtb2RhbDogTWV0aG9kIFwiICsgYSArIFwiIGRvZXMgbm90IGV4aXN0XCIpO1xuICB9O1xufSkoalF1ZXJ5KTsiXX0=
